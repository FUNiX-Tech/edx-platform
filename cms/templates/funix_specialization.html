<%page expression_filter="h"/>
<%inherit file="survey-base.html" />

<%namespace name='static' file='static_content.html'/>



<%!
from cms.djangoapps.contentstore import utils
from django.utils.translation import gettext as _
from openedx.core.djangolib.markup import HTML, Text
from openedx.core.djangolib.js_utils import (
    dump_js_escaped_json, js_escaped_string
)
import six
from six.moves.urllib.parse import quote
%>

<%block name="title">Specialization</%block>




<%block name="content"> 
<style>
  table, th, td {
    border:1px solid black;
    padding:10px;
  }
</style>

<div class="wrapper-mast wrapper">
    <header class="mast has-actions has-subtitle">
      <h1 class="page-header">
        <small class="subtitle">${_("Settings")}</small>
        <span class="sr">&gt; </span> Specialization
      </h1>
      <div class="preview-certificate nav-actions"></div>
    </header>
  </div>
<div class=" wrapper-content wrapper" >
     
  <section class="content">
    <article class="content-primary" role="main">
      <div class="wrapper-certificates certificates-list">
          <div class="notice notice-incontext notice-moduledisabled" style="background: #ffff; padding:60px; " >
                <div id="contet-setting-survey">
                  <div class="">


            
                  <form method="POST" action="/api/setting_specialization"  style="display: flex; flex-direction: column; gap: 20px;">
                
                    <input type="hidden" id="csrf_token" name="csrfmiddlewaretoken" value="${csrf_token}">
                    <input type="hidden" name="course_id" value="${context_course.id}">
                  
                          
                      <div>
                                <!-- create  Specialization -->
                          <label style="font-size: 18px;"> Created Specialization </label>
                          <input type="text" name="spec_name" />
                      </div>
                      <div>
                           <!-- set Specialization -->
                           <label style="font-size: 18px;">Set Specialization Course </label>
                      
                           <select name="specialization-select">
                               <option value=""></option>
                               % for e in all_spec:
                               <option value="${e.id}">${e}</span>
                              % endfor
                           </select>
                      </div>
                    
                     <div>
                        <button type="submit">Save</button>
                     </div>
                   
                  </form>

                  <div>
                      <label style="font-size: 18px;">List Specialization set course : </label>

                      <table>
                        % for c in list_spec_course:
                          <tr>
                            <td data-course="${c.course_id}" data-spec='${c.spec}'>${c.spec}</td>
                            <td>
                              <button onclick="handlerClick(this)" data-spec-id='${c.spec_id}' style="border: none; background: none;">
                                <i class="fa fa-trash" aria-hidden="true"></i>
                              </button>
                            </td>
                          </tr>
                      % endfor
                        
                      </table>
                  </div>
                   
                  
                  </div>
                </div>
          </div>
      </div>
    </article>
  </section>
           
</div>
<script>
  
  function getCookie(cookieName) {
    const name = cookieName + "=";
    const decodedCookie = decodeURIComponent(document.cookie);
    const cookieArray = decodedCookie.split(';');
    for (let i = 0; i < cookieArray.length; i++) {
        let cookie = cookieArray[i];
        while (cookie.charAt(0) === ' ') {
        cookie = cookie.substring(1);
        }
        if (cookie.indexOf(name) === 0) {
        return cookie.substring(name.length, cookie.length);
        }
    }
    return null; 
    }


 

  const handlerClick = async (e)=>{
    
    const tdElement = document.querySelector('td');
    const course_id = tdElement.getAttribute('data-course');
    const spec_id = e.getAttribute('data-spec-id');

    try {
      const csrftoken = getCookie('csrftoken')
      const response = await fetch('/api/remove_specialization_course', {
                method : 'POST',
                headers: {
                'Content-Type': 'application/json',
                 'X-CSRFToken': csrftoken
            },
            body: JSON.stringify({course_id:course_id, spec_id:spec_id}) 
            })

            location.reload();
        }
    catch (error) {
      console.log(error)
    }
   
  
  }
</script>

</%block>