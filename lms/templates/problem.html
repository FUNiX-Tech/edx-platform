<%page expression_filter="h"/>
<%!
from django.utils.translation import ngettext, gettext as _
from openedx.core.djangolib.markup import HTML
%>
<style>
  .container-problem{
    display : flex ;
    gap: 10px;
    padding-bottom : 10px;
  }
  .problem-question-number {
      padding : 4px 10px;
      background-color: #f6f6f7;
      text-align: center;
      color: #8097b1;
      font-size : 14px;
      border-radius: 4px;

  }

  .active-number {
    border-bottom: solid 2px #0086ff !important;
    background-color: rgba(0, 134, 255, 0.16) !important;

    color: #0086ff !important;
  }

  .submitted-question{
    color :#5aa447 ;
    border-bottom: solid 2px #5aa447;
    background-color: rgba(90, 164, 71, 0.16);

  }
  .err-number-qusetion {
    border-bottom: solid 2px #d82c0d;
    background-color: rgba(216, 44, 13, 0.16);
    color : #d82c0d
  }


.btn-custom{
  border : none !important;
  background-color :  #007ae6;
  color: #fff;
  background-image: none !important;
  text-shadow : none !important;
  box-shadow: none !important;

}
.btn-custom:hover {
  background : #025dae !important ;
}

.btn-custom[disabled]{
  background-color :  #c5c5c5;
}

.btn-prev {
  border : 1px solid  #007ae6!important;
  background : none ;
  color: #007ae6;
  background-image: none !important;
  text-shadow : none !important;
  box-shadow: none !important;
}
.btn-prev:hover {
  background : #eef7ff !important;
}

.btn-span{
  display: flex;
  align-items : center;

  gap: 5px;
}

.btn-span > i {
  font-size:18px
}

.problem .field  > label {
  border : none !important ;
}



.message{
  border-top : 1px solid #d7d7d7 ;
  padding-top : 20px;
}

.messages-box {
  align-self: stretch;
  flex-grow: 0;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: stretch;
  padding: 10px 14px;
  border-radius: 6px;
  border-left: solid 2px #5aa447;
  background-color: rgba(90, 164, 71, 0.05);
}

.explanation-title{
  align-self: stretch;
  flex-grow: 0;
  font-size: 1rem;
  font-weight: 500 !important;
  font-stretch: normal;
  font-style: normal;
  line-height: 1.5;
  letter-spacing: normal;
  text-align: left;

  padding-bottom: 10px;
}

.wrapper-problem-response  fieldset{
  padding:20px 0px;
}


.success-problem   {
  accent-color: #5aa447 !important;
}

.wrapper-problem-response fieldset {
  font-weight: 600;
}

.error-problem-answer {
  background-color: #FFE4E4  !important;
  border-left: solid 2px #D82C0D !important;
}

.problem-question-number:hover{
  cursor: pointer;
}


</style>

% if problem['name'] == 'Matching Problem' or problem['name'] == 'Quiz Problem Custom':
<style>
    * {
        padding: 0;
        margin: 0;
        box-sizing: border-box;
    }



    .question_matching_content {
        margin-top: 1.5rem !important;
        padding: 0 2rem !important;
        font-size: 1rem;
        font-weight: 500;
        color: #2c3744;
        margin-bottom: 0.25rem !important;
    }

    .sub_question_matching_content {
        padding: 0 2rem;
        font-size: 0.875rem;
        font-weight: normal;
        color: #576f8a;
        text-align: left;
        margin-bottom: 1.5rem !important;
    }

    .content_title {
        display: grid;
        grid-template-columns: 1fr 1fr;
        column-gap: 1rem;
        background-color: #e6e6e8;
        text-align: center;
        padding: 0 !important;
        margin: 0 !important;
    }

    .content_title_desc {
        padding: 0.5rem 1rem;
        font-size: 1.25rem;
        font-weight: 500;
        margin: 0 !important;
    }

    .matchinggroup {
        padding: 0;
        margin: 0;
        margin-bottom: 1.5rem !important;
    }

    .content_container {
        display: grid;
        grid-template-columns: 1fr 1fr;
        justify-items: stretch;
        grid-gap: 0 2rem;
        grid-template-areas: "left right";
        margin: 0 !important;
    }

    .left_content {
        padding: 0.5rem 1rem;
        margin: 0 !important;
        /* font-size: 1rem;
        font-weight: normal; */
        /* color: #2c3744; */
    }

    .left_content .left_content_desc {
        /* padding: 0.5rem 1rem; */
        font-size: 1rem;
        font-weight: normal;
        color: #2c3744;
        margin: 0 !important;
    }

    .right_content {
        margin: 0 !important;
        padding: 0.5rem 1rem 0.5rem 0 !important;
        position: relative;
    }

    .right_content::before {
        --width_stick: 0.0625rem;
        content: "";
        position: absolute;
        top: 0;
        left: -1rem;
        width: var(--width_stick);
        height: 100%;
        background-color: #d9d9d9;
        transform: translateX(-50%);
    }

    .right_content_item {
        display: inline-block;
        margin: 0 !important;
    }

    .right_content_item .right_content_item_drap_drop {
        outline: none;
        border: none;
        background: none;


        display: flex;
        justify-content: flex-start;
        align-items: center;
        gap: 8px;

        padding: 0.5rem 1rem 0.5rem 0.25rem;
        color: #fff !important;
        background-color: #007ae6;
        border-radius: 6px;
        cursor: grab;
        transition: all 0.3s ease-in-out;
        margin: 0 !important;

        /* New logic */
        user-select: none;
    }

    .right_content_item .right_content_item_drap_drop .image_container {
        display: block;
        /* min-width: 0; */
        /* width: 100%;
        height: 100%; */
        flex-shrink: 0;
        margin: 0 !important;
    }


    .right_content_item .right_content_item_drap_drop .image_container .img_right {
        margin: 0 !important;
        padding: 0;
        outline: none;
        border: none !important;
        background: none;
        width: 16px;
        height: 16px;
    }

    .right_content_item .right_content_item_drap_drop:hover {
        outline: none;
        border: none;
        background: none;
        background-color: #025dae;
    }

    .left {
        grid-area: left;
    }

    .right {
        grid-area: right;
    }

    .content_container:nth-child(odd) {
        background-color: #f6f6f7;
    }


    /* phần result */
    .matching_action {
        display: flex;
    }

    .submit_matching_btn {
        height: auto !important;
        display: inline-block;
        line-height: 1.5 !important;
        margin-top: 1.5rem;
        margin-left: auto;
        margin-right: 2rem;
        margin-bottom: 2rem;
        padding: 0.5rem 1rem !important;
        background-color: #007ae6 !important;
        color: #fff  !important;
        border-radius: 0.375rem !important;
        font-size: 1rem !important;
        font-weight: bold !important;
        cursor: pointer !important;
    }

    .submit_matching_btn:hover {
        background-color: #025dae !important;
    }

    .matching_result {
        margin: 1.5rem 2rem 0 !important;
        border-top: 1px solid #d7d7d7;
        padding-top: 1.5rem;
    }

    .matching_result_container {
        padding: 0.75rem 1rem;
        border-top-left-radius: 0.375rem;
        border-bottom-left-radius: 0.375rem;
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
        margin: 0 !important;
    }

    .matching_result_title {
        margin: 0 0 1.5rem 0 !important;
    }

    .matching_result_content {
        margin: 0 !important;
    }

    .matching_hidden {
        display: none;
    }

    .success_result {
        background-color: #F2FFEE;
        border-left: 2px solid #5AA447;
    }

    .error_result {
        background-color: #FFF1F1;
        border-left: 2px solid #D82C0D;
    }

    .hidden_matching_btn {
        display: none !important;
    }

</style>
%endif

<%namespace name='static' file='static_content.html'/>
<h3 class="hd hd-3 problem-header" id="${ short_id }-problem-title" aria-describedby="${ id }-problem-progress" tabindex="-1">

  % if problem['name'] == 'Quiz Problem Custom' :
    Quiz
  %else :
    ${ problem['name'] }
  %endif
</h3>



<div class="problem" id="${ "-".join(problem['name'].lower().split())}">


  ${ HTML(problem['html']) }


  <div class="action">
    <input type="hidden" name="problem_id" value="${ problem['name'] }" />
    % if demand_hint_possible:
      <div class="problem-hint">
        <%include file="problem_notifications.html" args="
         notification_name='hint',
         notification_type='problem-hint',
         notification_icon='fa-question',
         notification_message=''"
       />
      </div>
    % endif

    <div class="problem-action-buttons-wrapper">


      % if problem['name'] == 'Quiz Problem Custom' :
      <div id='problem-buttom' data-problem-name="${problem['name']}" style="padding-top:10px">
        <span style='display:flex; gap: 10px'>

          <button id='btn-next' class='btn-custom' style='display:none'> <span class='btn-span'>

            Câu hỏi tiếp theo  <i class="bi bi-arrow-right"></i>
          </span></button>

          <button class='btn-submit-qz btn-custom' > Trả lời  </button>
          <button  class=" btn-custom submit_matching_btn matching_quiz_custom" data-submitting="${ submit_button_submitting }" data-value="${ submit_button }" data-should-enable-submit-button="${ should_enable_submit_button }" aria-describedby="submission_feedback_${short_id}">
                Trả lời
          </button>


          <button class=' btn-custom' id='btn-next-lesson'  style='display:none'> Hoàn thành   </button>

        </span>

      </div>

      % elif problem['name'] == 'Matching Problem':
      <button type="button" class="submit btn-brand submit_matching_btn" data-submitting="${ submit_button_submitting }" data-value="${ submit_button }" data-should-enable-submit-button="${ should_enable_submit_button }" aria-describedby="submission_feedback_${short_id}" ${'' if should_enable_submit_button else 'disabled'}>
        Trả lời matching
      </button>

      %endif

      % if demand_hint_possible:
        % if problem['name'] != 'Quiz Problem Custom':
            <span class="problem-action-button-wrapper">
              <button type="button" class="hint-button problem-action-btn btn-link btn-small" data-value="${_('Hint')}" ${'' if should_enable_next_hint else 'disabled'}>${_('Hint')}</button>
          </span>
        %endif

      % endif
      % if save_button:
      <span class="problem-action-button-wrapper">
          <button type="button" class="save problem-action-btn btn-link btn-small" data-value="${_('Save')}">
              <span aria-hidden="true">${_('Save')}</span>
              <span class="sr">${_("Save your answer")}</span>
          </button>
      </span>
      % endif
      % if reset_button:
      <span class="problem-action-button-wrapper">
          <button type="button" class="reset problem-action-btn btn-link btn-small" data-value="${_('Reset')}"><span aria-hidden="true">${_('Reset')}</span><span class="sr">${_("Reset your answer")}</span></button>
      </span>
      % endif
      % if answer_available and problem['name'] != 'Quiz Problem Custom':
      <span class="problem-action-button-wrapper">
          <button type="button" class="show problem-action-btn btn-link btn-small" aria-describedby="${ short_id }-problem-title"><span class="show-label">${_('Show answer')}</span></button>
      </span>
      % endif
    </div>
    <div class="submit-attempt-container">

      % if problem['name'] != 'Quiz Problem Custom':
        % if problem['name'] != 'Matching Problem':
        <button type="button" class="submit btn-brand" data-submitting="${ submit_button_submitting }" data-value="${ submit_button }" data-should-enable-submit-button="${ should_enable_submit_button }" aria-describedby="submission_feedback_${short_id}" ${'' if should_enable_submit_button else 'disabled'}>
          <span class="submit-label">${ submit_button }</span>
        </button>
        % endif
      % elif problem['name'] != 'Matching Problem':
        <button style="display: none;" type="button" class="submit btn-brand" data-submitting="${ submit_button_submitting }" data-value="${ submit_button }" data-should-enable-submit-button="${ should_enable_submit_button }" aria-describedby="submission_feedback_${short_id}" ${'' if should_enable_submit_button else 'disabled'}>
            <span class="submit-label">${ submit_button }</span>
        </button>
      % endif


      % if submit_disabled_cta:
        % if submit_disabled_cta.get('event_data'):
          <button class="submit-cta-link-button btn-link btn-small" onclick="emit_event(${submit_disabled_cta['event_data']})">
            ${submit_disabled_cta['link_name']}
          </button>
          <span class="submit-cta-description" tabindex="0" role="note" aria-label="description">
            <span data-tooltip="${submit_disabled_cta['description']}" data-tooltip-show-on-click="true"
              class="fa fa-info-circle fa-lg" aria-hidden="true">
            </span>
          </span>
          <span class="sr">(${submit_disabled_cta['description']})</span>
        % else:
            <form class="submit-cta" method="post" action="${submit_disabled_cta['link']}">
              <input type="hidden" id="csrf_token" name="csrfmiddlewaretoken" value="${csrf_token}">
              % for form_name, form_value in submit_disabled_cta['form_values'].items():
                  <input type="hidden" name="${form_name}" value="${form_value}">
              % endfor
              <button class="submit-cta-link-button btn-link btn-small">
                ${submit_disabled_cta['link_name']}
              </button>
              <span class="submit-cta-description" tabindex="0" role="note" aria-label="description">
                <span data-tooltip="${submit_disabled_cta['description']}" data-tooltip-show-on-click="true"
                  class="fa fa-info-circle fa-lg" aria-hidden="true">
                </span>
              </span>
              <span class="sr">(${submit_disabled_cta['description']})</span>
            </form>
        % endif
      % endif
      <div class="submission-feedback ${'cta-enabled' if submit_disabled_cta else ''}" id="submission_feedback_${short_id}">
        ## When attempts are not 0, the CTA above will contain a message about the number of used attempts
        % if attempts_allowed and (not submit_disabled_cta or attempts_used == 0):
          ${ngettext("You have used {num_used} of {num_total} attempt", "You have used {num_used} of {num_total} attempts", attempts_allowed).format(num_used=attempts_used, num_total=attempts_allowed)}
        % endif
        <span class="sr">${_("Some problems have options such as save, reset, hints, or show answer. These options follow the Submit button.")}</span>
      </div>
    </div>
  </div>
    <%include file="problem_notifications.html" args="
      notification_type='warning',
      notification_icon='fa-exclamation-circle',
      notification_name='gentle-alert',
      notification_message=''"
    />
    % if answer_notification_type:
        % if 'correct' == answer_notification_type:
            <%include file="problem_notifications.html" args="
                notification_type='success',
                notification_icon='fa-check',
                notification_name='submit',
                is_hidden=False,
                notification_message=answer_notification_message"
            />
        % endif
        % if 'incorrect' == answer_notification_type:
            <%include file="problem_notifications.html" args="
                notification_type='error',
                notification_icon='fa-close',
                notification_name='submit',
                is_hidden=False,
                notification_message=answer_notification_message"
            />
        % endif
        % if 'partially-correct' == answer_notification_type:
            <%include file="problem_notifications.html" args="
                notification_type='success',
                notification_icon='fa-asterisk',
                notification_name='submit',
                is_hidden=False,
                notification_message=answer_notification_message"
            />
        % endif
        % if 'submitted' == answer_notification_type:
            <%include file="problem_notifications.html" args="
                notification_type='general',
                notification_icon='fa-info-circle',
                notification_name='submit',
                is_hidden=False,
                notification_message=answer_notification_message"
            />
        % endif
    % endif
    <%include file="problem_notifications.html" args="
      notification_type='warning',
      notification_icon='fa-save',
      notification_name='save',
      notification_message=save_message,
      is_hidden=not has_saved_answers"
    />
    <%
        notification_message=_('Answers are displayed within the problem')
    %>
    <%include file="problem_notifications.html" args="
      notification_type='general',
      notification_icon='fa-info-circle',
      notification_name='show-answer',
      notification_message=notification_message,
      is_hidden=True"
    />
  </div>
  <script>
      function emit_event(message) {
          parent.postMessage(message, '*');
      }
  </script>
% if problem['name'] == 'Quiz Problem Custom':
<script >
  const problemElement = document.querySelector('#quiz-problem-custom');
  if (problemElement){
    const btnNextLesson = problemElement.querySelector('#btn-next-lesson');

    btnNextLesson.addEventListener('click', async () => {
      try {
        const headerProblem = document.querySelector('.xblock-student_view');
        const usage_key_string = headerProblem.getAttribute('data-usage-id');
        const response = await fetch('/api/course_home/next_lesson/' + usage_key_string);

        if (!response.ok) {
            throw new Error('Network response was not ok');
        }

        const data = await response.json();

          window.parent.postMessage({ type: 'quiz_submit' , ...data}, "*")
      } catch (error) {
          console.error('There was a problem with the fetch operation:', error);
      }
  });

    const problemList = problemElement.querySelectorAll('.wrapper-problem-response');
    const btnSubmit = document.querySelector('.btn-submit-qz')
    const btnNext = document.querySelector('#btn-next')
    const problemBtn = document.querySelector('#problem-buttom')
    const matchingBtn = document.querySelector('.matching_quiz_custom')

    // console.log("matchingBtn", matchingBtn)
    var currentIndex = 0;


    if ( btnSubmit && btnNext) {
      const divContainer = document.createElement('div');
      divContainer.classList.add('container-problem');


      for (var i = 0; i < problemList.length; i++) {
        // console.log('problemList', problemList[i])
        if(i > 0){
          problemList[i].style.display = 'none'
        }
        const spanElement = document.createElement('span');
        spanElement.textContent = (i + 1).toString();
        spanElement.classList.add('problem-question-number');
        spanElement.setAttribute('data-problem-number-id', i.toString());

        const submittedInput = problemList[i].querySelector('input.submitted');
        const incorrectLabel = problemList[i].querySelector('label.choicegroup_correct');
        const wrongLabel = problemList[i].querySelector('label.choicegroup_incorrect')
        const indicatorError = problemList[i].querySelector('.indicator-container')

        if (indicatorError){
          indicatorError.style.display = 'none'
        }


      
        
        const matchingDiv = problemList[i].querySelector('div[question_matching="True"]')

        
        if(matchingDiv){
          const matchingError = problemList[i].querySelector('.error_result')
          const matchingSucces =  problemList[i].querySelector('.success_result')
          if ( matchingError){
            spanElement.classList.add('err-number-qusetion')
          } else if (matchingSucces){
            spanElement.classList.add('submitted-question')
          }
        }


        if (i == 0){
            const matchingDiv = problemList[i].querySelector('div[question_matching="True"]')
            const resultMatchingCorrect = problemList[i].querySelector('.matching_result_container.success_result')
            const resultMatchingIncorrect = problemList[i].querySelector('.matching_result_container.error_result')
            console.log("matchingDiv", matchingDiv)
            // console.log("resultMatching", resultMatching)
            if (matchingDiv) {
                matchingBtn.style.display = 'block'
                btnSubmit.style.display = 'none';
            } else {
                matchingBtn.style.display = 'none'
            }

          spanElement.classList.add('active-number')

          if (submittedInput && incorrectLabel) {
            console.log("spanElement i = 0", spanElement)
            console.log("resultMatching i = 0", resultMatchingCorrect)
            btnSubmit.style.display = 'none';
            btnNext.style.display = 'block';
            spanElement.classList.add('submitted-question');
            const inputs = problemList[i].querySelectorAll('input:checked');
            inputs.forEach(input => input.classList.add('success-problem'))
          }
          else if (submittedInput && wrongLabel){
            spanElement.classList.add('err-number-qusetion');
          }
          else if (resultMatchingCorrect){
            spanElement.classList.add('submitted-question');
          } else if (resultMatchingIncorrect) {
            spanElement.classList.add('err-number-qusetion');
          }


        } else {
            console.log("spanElement i != 0", spanElement)
            // console.log("resultMatching i != 0", resultMatching)
            const resultMatchingCorrect = problemList[i].querySelector('.matching_result_container.success_result')
            const resultMatchingIncorrect = problemList[i].querySelector('.matching_result_container.error_result')


            if (submittedInput && incorrectLabel) {
          spanElement.classList.add('submitted-question');
          btnSubmit.style.display = 'none';
          btnNext.style.display = 'block';
          const inputs = problemList[i].querySelectorAll('input:checked');
          inputs.forEach(input => input.classList.add('success-problem'))
          }
          else if (submittedInput && wrongLabel){
            spanElement.classList.add('err-number-qusetion');

          } else if (resultMatchingCorrect){
            spanElement.classList.add('submitted-question');
          } else if (resultMatchingIncorrect) {
            spanElement.classList.add('err-number-qusetion');
          }
        }

        divContainer.appendChild(spanElement);

        const checkInput = problemList[i].querySelectorAll('input[type="checkbox"], input[type="radio"]' )
        checkInput.forEach(input => {
          input.addEventListener('change', ()=>{
            const atLeastOneChecked = Array.from(checkInput).some(inp => inp.checked);
            if (atLeastOneChecked) {
              btnSubmit.removeAttribute('disabled');
            } else {
              btnSubmit.setAttribute('disabled', true);
            }
          });
        });




      }

      problemElement.insertBefore(divContainer, problemElement.firstChild);
      if ( problemList.length == 1){
        document.querySelector('.container-problem').style.display= 'none'
      }




      const elementsError = document.querySelectorAll('.err-number-qusetion');
      elementsError.forEach((elementError) => {
        const numberError = elementError.textContent;
        const indicatorError = problemList[numberError - 1].querySelector('.indicator-container');
        const matchingQz = problemList[numberError - 1].querySelector('div[question_matching="True"]')
       
        if (matchingQz){
          return 
        }

        if (indicatorError){
          indicatorError.style.display = 'block';
        }

        const existingMessgasBox = problemList[numberError - 1].querySelector('.feedback-hint-incorrect');

        if (existingMessgasBox) {
          existingMessgasBox.classList.add('error-problem-answer');
          const title = problemList[numberError - 1].querySelector('.explanation-title');
          title.textContent = 'Câu trả lời của bạn chưa chính xác';
        } else {
          const newMessgasBox = document.createElement('div');
          newMessgasBox.classList.add('feedback-hint-incorrect', 'error-problem-answer' , "messages-box");
          const title = document.createElement('div');
          title.classList.add('explanation-title');
          title.style.paddingBottom = '0px'
          title.textContent = 'Câu trả lời của bạn chưa chính xác';
          newMessgasBox.appendChild(title);
          problemList[numberError - 1].appendChild(newMessgasBox);

        }
      });

    const elementsSubmitted = document.querySelectorAll('.submitted-question')
    elementsSubmitted.forEach((element)=>{
      const numberSubmitted = element.textContent;
      const problemElement = problemList[numberSubmitted - 1];
      const matchingQz = problemElement.querySelector('div[question_matching="True"]')
      if (matchingQz){
        return 
      }
      if (problemElement) {
        const titleElement = problemElement.querySelector('.explanation-title');
        if (titleElement) {
          titleElement.textContent = 'Bạn đã trả lời đúng';
        } else {
          const htmlString =
              '<span class="message">' +
                '<div class="feedback-hint-correct messages-box">' +
                  '<div class="explanation-title">Bạn đã trả lời đúng</div>' +
                '</div>' +
              '</span>';

              const tempElement = document.createElement('div');
              tempElement.innerHTML = htmlString;
                  problemElement.appendChild(tempElement);
        }
      }


    })


      const btnNumber = document.querySelectorAll('.problem-question-number');
      // UFC - xử lý khi click vào nút next và ẩn hiển nút btn matching submit
      btnNumber.forEach(function(element) {
        element.addEventListener('click', function() {
          const numnberId = element.getAttribute('data-problem-number-id');


          btnSubmit.setAttribute('disabled', true);

          currentIndex = parseInt(numnberId, 10);
          btnNumber.forEach(function(btn) {
            btn.classList.remove('active-number');
          });

          problemList.forEach(function(problem) {
            problem.style.display = 'none';
          });

          const submittedInput = problemList[currentIndex].querySelector('input.submitted');
          const incorrectLabel = problemList[currentIndex].querySelector('label.choicegroup_correct');
          const wrongLabel = problemList[currentIndex].querySelector('label.choicegroup_incorrect')
          const matchingDiv = problemList[currentIndex].querySelector('div[question_matching="True"]')


          if (problemList[currentIndex]) {
            problemList[currentIndex].style.display = 'block';
            element.classList.add('active-number')
            // console.log('problemList[currentIndex]', problemList[currentIndex])
            // console.log('matchingDiv', matchingDiv)
            // console.log("btnSubmit", btnSubmit)

          if (element.classList.contains('err-number-qusetion')) {
            const indicator = problemList[currentIndex].querySelector('.indicator-container')
            if (indicator){

              indicator.style.display = 'block';
            }

            btnNext.style.display = 'none';
            btnSubmit.style.display = 'block';

            const messgasBox = problemList[currentIndex].querySelector('.feedback-hint-incorrect');
            if (messgasBox){

              messgasBox.classList.add('error-problem-answer');
            }


              const checkedInput = problemList[currentIndex].querySelectorAll('.field input:checked')

              checkedInput.forEach(function (element,index) {

                const input = element;
                const label = document.querySelector('label[for="' + element.id + '"]');
                input.classList.add('submitted');
                input.classList.remove('success-problem');
                label.classList.remove('choicegroup_correct')
                label.classList.add( 'choicegroup_incorrect');
            });

          }


          if (incorrectLabel){
            btnNext.style.display = 'block';
            btnSubmit.style.display = 'none';
          }
          else if (!incorrectLabel && !wrongLabel){
            btnNext.style.display = 'none';
            btnSubmit.style.display = 'block';
          }
          else if (wrongLabel){
            btnNext.style.display = 'none';
            btnSubmit.style.display = 'block';
          }
          if (matchingDiv) {
            const matchingSuccess = problemList[currentIndex].querySelector('.success_result')
            const matchingError = problemList[currentIndex].querySelector('.error_result')
  
            if (matchingSuccess){
              matchingBtn.style.display ='none'
              btnSubmit.style.display = 'none';
              btnNext.style.display = 'block';
            }else if (matchingError){
              matchingBtn.style.display ='block'
              btnSubmit.style.display = 'none';
              btnNext.style.display = 'none';
            }
            else {
              matchingBtn.style.display ='block'
            }
           
          } else {
            matchingBtn.style.display ='none'
          }

          const checkInput = problemList[currentIndex].querySelectorAll('input[type="checkbox"], input[type="radio"]' )

          checkInput.forEach(input => {
            input.addEventListener('change', ()=>{
              const atLeastOneChecked = Array.from(checkInput).some(inp => inp.checked);
              if (atLeastOneChecked) {
                btnSubmit.removeAttribute('disabled');
              } else {
                btnSubmit.setAttribute('disabled', true);
              }
            });
          });

          }



          const submittedQuestions = document.querySelectorAll('.submitted-question');
          if ( currentIndex+1 == submittedQuestions.length && submittedQuestions.length == btnNumber.length   ){
            btnNext.style.display = 'none';
            btnNextLesson.style.display = 'block'
          }else {
            btnNextLesson.style.display = 'none'
          }

        });

      });



    }

  }


</script>
%endif

% if problem['name'] == 'Matching Problem' or problem['name'] == 'Quiz Problem Custom':
<script>
    const rightItem = document.querySelectorAll(".right_content_item");
    const rightItemBtn = document.querySelectorAll(".right_content_item .right_content_item_drap_drop");
    let draggedItem = null;

    rightItemBtn.forEach(function(btn) {
        btn.addEventListener("dragstart", function (e) {
            draggedItem = btn.innerHTML;
        });

        btn.addEventListener("dragend", function (e) {
            console.log("dragend", btn);
            btn.innerHTML = draggedItem;
            draggedItem = null;

            const inputName = btn.dataset.inputName
            console.log("inputName", inputName);

            const imgEle = document.querySelectorAll(`img[data-right-result]`);
            console.log("imgEle", imgEle);
            const imgValue = [];
            imgEle.forEach(function(img) {

                if (img.nodeName === 'IMG' && img.name === inputName) {
                    console.log("img", img);
                    imgValue.push(img.getAttribute('data-right-result'));
                }

            });
            console.log("imgValue", imgValue);

            const inputEle = document.querySelectorAll(`input[data-left-value]`);
            console.log("inputEle", inputEle);

            const inputValue = [];
            let i = 0;
            inputEle.forEach(function(input) {

                if (input.nodeName === 'INPUT' && input.name === inputName && i < imgValue.length) {
                    let currentValue = input.value;
                    if (currentValue.length > 0) {
                        const lastPartInput = currentValue.substring(currentValue.lastIndexOf("_") + 1);
                        console.log("lastPartInput", lastPartInput);
                        const lastPartImg = imgValue[i].substring(imgValue[i].lastIndexOf("_") + 1);
                        console.log("lastPartImg", lastPartImg);

                        const test_new_string = currentValue.replace(lastPartInput, lastPartImg);
                        console.log("test_new_string", test_new_string);

                        input.value = test_new_string;
                    }
                    i++;
                    inputValue.push(input.value);
                }

            });
            console.log("inputValue", inputValue);



        });
    });

    rightItem.forEach( function(item) {
        item.addEventListener("dragover", function (e) {
            e.preventDefault();
        });

        item.addEventListener("drop", function (e) {
            e.preventDefault();
            const cloneItem = item.querySelector(".right_content_item_drap_drop").innerHTML;

            item.querySelector(".right_content_item_drap_drop").innerHTML = draggedItem;

            draggedItem = cloneItem;


        });
    });

</script>
%endif

<div>

