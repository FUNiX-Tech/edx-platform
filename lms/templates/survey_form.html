<%page expression_filter="h"/>
 <%inherit file="main_survey.html" /> 
 <%def name="online_help_token()"><% return "learnerdashboard" %></%def> 
 <%namespace name='static' file='static_content.html'/> 




<%block name="pagetitle">Survey Form</%block>

<Link rel='stylesheet' href="../static/survey_form/survey_form.css" />



<div >
   <div>
        <h1 style=" font-size:26px;">
            % if display_name :
                ${display_name}
            %else:
                Funix
            % endif
            Welcome Flow
        </h1>
   </div>
        <div class="border-navbar "  >
            
       </div>
 
    <form method="post">
        <div id="formContainer">
            <div class="survey-form"  style="display: block;">
                <div class="title-survey">
                    <h3>Welcome Funix!</h3>
                    <p> In the next few minutes, you'll take the first steps on your learning journey:</p>
                </div>
                <div class="container-survey">
                    <div class="survey-item">
                        <div class="circle">
                            <span class="number">1</span>
                        </div>
                        <span>Answer a few questions to help us personalize your experience</span>
                    </div>
                    <div class="survey-item">
                        <div class="circle  with-line">
                            <span class="number">2</span>
                        </div>
                        <span>See the projects you will build to graduate</span>
                    </div>
                    <div class="survey-item">
                        <div class="circle">
                            <span class="number">3</span>
                        </div>
                        <span>Go To Classroom</span>
                    </div>
                </div> 
            </div>

            % if result_lists:
                % for survey in result_lists:
                    <div class="survey-form"  style="display: none;">
                        <div class="card">
                            <div class="card-header">
                                <span>${survey['survey_name']}</span>
                            </div>
                       
                        <div class="card-body">
                            % for q in survey['questions']:
                                % if q.type == 'text' :
                                <div class="input-item-text" >
                                    <span>
                                        ${q.question}
                                    </span>
                                    <input type="hidden" id="csrf_token" name="csrfmiddlewaretoken" value="${csrf_token}">
                                    <input type='text' name="${q.question}" style="width:100%"/>
                                </div>
                                % endif

                                % if q.type == 'radio' or q.type == 'checkbox':
                                    <div style="display: flex;
                                    flex-direction: column;
                                    padding: 20px 0px;
                                    gap: 10px;">
                                    <span style="font-weight:bold">${q.question}</span>
                                     % for index,option in enumerate(q.config['option']) :
                                        <div class="survey-item-input">
                                        <input type="hidden" id="csrf_token" name="csrfmiddlewaretoken" value="${csrf_token}">
                                            <input id="${option}" type=${q.type} name="${q.question}" value="${option}"/>
                                            <label for="${option}" >${option}</label>
                                        </div>
                                    % endfor
                                    </div>
                                % endif 

                                % if q.type == 'select' :
                                    <div class="input-item-select">
                                        <input type="hidden" id="csrf_token" name="csrfmiddlewaretoken" value="${csrf_token}">
                                        <span>${q.question}</span>
                                        <select name="${q.question}">
                                            % for option in q.config['option']:
                                                <option value="${option}">${option}</option>
                                            % endfor
                                        </select>
                                    </div>
                                % endif
                            % endfor
                        </div>
                    </div>
                    </div>
                % endfor
            % endif

            <div class="survey-form"  style="display: none;">
                <div style="display: flex; flex-direction:column; align-items:center; gap:40px; justify-content:center; height:400px; " >
                    <div>
                        <img srcset="https://img.icons8.com/?size=200&amp;id=vUCza84W30iX&amp;format=png 2x, https://img.icons8.com/?size=200&amp;id=vUCza84W30iX&amp;format=png 1x" src="https://img.icons8.com/?size=200&amp;id=vUCza84W30iX&amp;format=png 2x" alt="Rocket" loading="lazy" width="140" height="140" style="width: 140px; height: 140px;" >
                    </div>
                    <div style="text-align: center;">
                        <h4 style="font-size: 22px;  padding-bottom:12px">Your're all set!</h4>
                        <p>Click "Go To Classroom" to get started with your program.</p>
                    </div>
                </div>
            </div>
          
        </div>

        <div style="padding-top:20px">
            <div class="survey-btn">
                <button class="backButton survey-btn-item btn-back" type="button" onclick="changeForm(-1)" style="display: none;">
                    <div style="display:flex; gap:4px; justify-content:center; align-items:center">
                        <span  class="btn-back-icon"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="30px" height="30px" viewBox="0,0,256,226"><g fill="#382efc" fill-rule="nonzero" stroke="none" stroke-width="1" stroke-linecap="butt" stroke-linejoin="miter" stroke-miterlimit="10" stroke-dasharray="" stroke-dashoffset="0" font-family="none" font-weight="none" font-size="none" text-anchor="none" style="mix-blend-mode: normal"><g transform="scale(5.12,5.12)"><path d="M19.8125,13.09375c-0.21875,0.03906 -0.41406,0.14844 -0.5625,0.3125l-10.90625,10.875l-0.6875,0.71875l0.6875,0.71875l10.90625,10.875c0.24219,0.29688 0.62891,0.43359 1.00391,0.34766c0.37109,-0.08594 0.66406,-0.37891 0.75,-0.75c0.08594,-0.375 -0.05078,-0.76172 -0.34766,-1.00391l-9.1875,-9.1875h29.53125c0.35938,0.00391 0.69531,-0.18359 0.87891,-0.49609c0.17969,-0.3125 0.17969,-0.69531 0,-1.00781c-0.18359,-0.3125 -0.51953,-0.5 -0.87891,-0.49609h-29.53125l9.1875,-9.1875c0.32422,-0.30078 0.41016,-0.77734 0.21484,-1.17187c-0.19141,-0.39844 -0.625,-0.61719 -1.05859,-0.54687z"></path></g></g></svg></span>
                        <span> Back</span>
                    </div>
                   
                </button>
                <button class="nextButton survey-btn-item" type="button" onclick="changeForm(1)">Let's Go!</button>
                <button class="submitButton survey-btn-item" type="submit" style="display: none;">Go To Classroom</button>

              
            </div>
        </div>
    </form>
</div>




<script>
    let currentFormIndex = 0;
    const backButton = document.querySelector('.backButton');
    const nextButton = document.querySelector('.nextButton');
    const submitButton = document.querySelector('.submitButton');
    const borderNavbar = document.querySelector('.border-navbar')
    const forms = document.querySelectorAll('.survey-form');
    const textError = document.querySelector('.text-error')


    for(let i = 0; i< forms.length; i++){
        const newSpan = document.createElement('span')
        newSpan.classList.add('border-navbar-item')
        borderNavbar.appendChild(newSpan)
    }
    const newSpanBegin = document.querySelectorAll('.border-navbar-item')[0]
    if (!newSpanBegin.classList.contains('border-current')) {
        newSpanBegin.classList.add('border-current');
      }


    function validateInput (currentFormIndex){
        let isRadioChecked = false
        let isCheckboxChecked = false
        let isCheckText = false

        if (currentFormIndex === 0){
            isCheckboxChecked = true
            isRadioChecked = true
        }

        const presentForms = forms[currentFormIndex];
        const presentInput = presentForms.querySelectorAll('input');
        let inputRadio = []
        let inputCheckBox = []
        let inputText = []

        presentInput.forEach((input) => { 
            if(input.type === 'radio'){
                inputRadio.push(input)
            }
            if (input.type === 'checkbox'){
                inputCheckBox.push(input)
            }
            if(input.type === 'text'){
                inputText.push(input)
            }
        
        });
        
        inputRadio.forEach(input =>{
            if(input.checked){
                isRadioChecked = true
            }
        })
       
        inputCheckBox.forEach(input =>{
            if(input.checked){
                isCheckboxChecked = true
            }
        })


        inputText.forEach(input =>{
            if(input.value.trim() !== ''){
                isCheckText = true
            }
        })


        if (inputRadio.length === 0){
            isRadioChecked = true
        }
        if(inputCheckBox.length === 0){
            isCheckboxChecked = true
        }
        if(inputText.length === 0){
            isCheckText = true
        }
        


        return {
            isRadioChecked ,
            isCheckboxChecked,
            isCheckText
        }
    }

    function errorMessage (currentFormIndex){
        const presentForm = forms[currentFormIndex]
        const cardBody = presentForm.querySelector('.card-body')
        const existingError = cardBody.querySelector('.error-message')
        if(!existingError){
            const newSpan = document.createElement('span')
            newSpan.textContent = 'Error: Fields must not be left empty!'
            newSpan.className = 'error-message'
            cardBody.insertBefore(newSpan, cardBody.firstChild)
        }
    }



    function changeForm(step) {
        const newSpan = document.querySelectorAll('.border-navbar-item')
        for (const span of newSpan) {
            span.classList.remove('border-current');
        }

        
        const {isRadioChecked ,isCheckboxChecked, isCheckText} = validateInput(currentFormIndex)
      

   
        if(!isRadioChecked){
          errorMessage(currentFormIndex)
            
        }else if (!isCheckboxChecked){
            errorMessage(currentFormIndex)
        }else if (!isCheckText){
           errorMessage(currentFormIndex)
        }
        else {
            const errorMessage = document.querySelector('.error-message')
            if(errorMessage){

                errorMessage.remove()
            }
            forms[currentFormIndex].style.display = 'none';
            currentFormIndex += step;

        }
        


        if (currentFormIndex < 0) {
            currentFormIndex = 0;
        } else if (currentFormIndex >= forms.length) {
            currentFormIndex = forms.length - 1;
        }

        for (let i = 0; i <= currentFormIndex; i++) {
            newSpan[i].classList.add('border-current');

            if(currentFormIndex === (newSpan.length - 1)){
                newSpan[i].classList.add('border-current-success');
            }
        }


        if(currentFormIndex !== (newSpan.length - 1) ){
            for (const span of newSpan) {
                span.classList.remove('border-current-success');
            }
        }


        forms[currentFormIndex].style.display = 'block';


        backButton.style.display = (currentFormIndex === 0 || currentFormIndex === (forms.length-1)) ? 'none' : 'block';
        nextButton.style.display = currentFormIndex === forms.length - 1 ? 'none' : 'block';
        submitButton.style.display = currentFormIndex === forms.length - 1 ? 'block' : 'none';


        if (currentFormIndex === 0) {
            nextButton.textContent = "Let's Go!";
            nextButton.classList.remove('btn-next')
        } 
         else {
            nextButton.textContent = "Next";
            nextButton.classList.add('btn-next')
        }

        
 
    }

    backButton.style.display = 'none';

    if (forms.length <= 1) {
        nextButton.style.display = 'none';

    }



</script>



